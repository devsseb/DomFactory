/** 
 * DomFactory v1.0.0
 * DOM element creation facilitor
 * https://github.com/devsseb/DomFactory
 * 
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
"use strict";var DomFactory=function(){var e=[String,HTMLElement,Node,Array];new MutationObserver(function(e){if(r.length)for(var n=0;n<e.length;n++){for(var o=0;o<e[n].addedNodes.length;o++)if(e[n].addedNodes[o].nodeType!=Node.TEXT_NODE){for(var a=0;a<r.length;a++)i.inElement(e[n].addedNodes[o],r[a])&&(r[a].dispatchEvent(t),delete r[a]);if(!(r=r.filter(e=>e)).length)return}if(!r.length)return}}).observe(document,{childList:!0,subtree:!0});var t=new Event("append"),n=new Event("create"),r=[],i=function(e,t){this.layouts=e||{},this.apis=t||{}};i.prototype.addLayout=function(e,t){for(var n=e.split("."),r=this.layouts,i=0;i<n.length-1;i++)null==r[e=n[i]]&&(r[e]={}),r=r[e];return r[n[n.length-1]]=t,this},i.prototype.addApi=function(e,t){for(var n=e.split("."),r=this.apis,i=0;i<n.length-1;i++)null==r[e=n[i]]&&(r[e]={}),r=r[e];return r[n[n.length-1]]=t,this},i.prototype.getLayout=function(e){for(var t,r,o=e.split("."),a=Array.prototype.slice.call(arguments,1),l=-1;l<o.length;l++)if(-1==l?(t=this.layouts,r=this.apis):(t=t[o[l]],null!=r&&(r=r[o[l]])),"function"==typeof t&&(t=t.apply(this,a)),"function"==typeof r&&(r=r.apply(this,a)),null==t)return void console.error('[DomFactory] Layout "'+e+'" not found');r=r||{};var s=this.createElement(t),f=s;Array.isArray(f)||(f=[f]);for(l=0;l<f.length;l++)f[l].setAttribute("layout",e),i.elementApplyDefinition(f[l],{api:r}),f[l].dispatchEvent(n);return s.domfactoryinstance=this,s},i.createElement=i.prototype.createElement=function(e){return null==e&&(e={}),Array.isArray(e)?i.createElementFromArray(e):e instanceof HTMLElement?i.createElementFromElement(e):"string"==typeof e||e instanceof String?i.createElementFromString(e):i.createElementFromDefinition(e)},i.createElementFromArray=function(e){for(var t,n=[],r=0;t=e[r];r++)r==e.length-1&&e.domfactorydefinition&&("function"==typeof t.set?t=t.set(e.domfactorydefinition):(null==t.domfactorydefinition&&(t.domfactorydefinition={}),t.domfactorydefinition.assign(definition.domfactorydefinition))),n.push(i.createElement(t));return n},i.createElementFromElement=function(e){return null!=e.domfactorydefinition&&(i.elementApplyDefinition(i.getElementLastChild(e),e.domfactorydefinition),delete e.domfactorydefinition),e},i.createElementFromString=function(e){for(var t,n=/[> ]?(?:#\D[\w_-]*|\.[\w_-]+|\[([\w_-]+)(?:=(?:"([\s\S]*?)"|([\s\S]*?)))?\]|[\w_-]*)/g,r=null,o=null,a={};null!==(t=n.exec(e))&&t.index!=e.length;){var l=(f=t[0]).substr(0,1);if(">"!=l&&" "!=l||(o?o.children=a:r=a,o=a,a={},l=(f=f.substr(1)).substr(0,1)),"#"==l)a.id=f.substr(1);else if("."==l)a.class||(a.class=[]),a.class.push(f.substr(1));else if("["==l){var s=t[1],f="";void 0!==t[2]&&(f=t[2]),void 0!==t[3]&&(f=t[3]),a[s]=f}else f&&(a.tag=f)}return e instanceof String&&null!=e.domfactorydefinition&&i.definitionAssign(a,e.domfactorydefinition),o?o.children=a:r=a,i.createElement(r)},i.createElementFromDefinition=function(e){var t,n=null;return void 0!==e.selector?(t=i.createElement(e.selector),n=i.getElementLastChild(t)):t=n="text"==e.tag?document.createTextNode(""):document.createElement(e.tag||"div"),i.elementApplyDefinition(n,e),t},i.getElementLastChild=function(e){for(var t=e;t.lastElementChild;)t=t.lastElementChild;return t},i.definitionAssign=function(e,t){for(var n in t)Array.isArray(e[n])?(Array.isArray(t[n])||(t[n]=t[n].split(" ")),e[n]=e[n].concat(t[n])):"object"==typeof e[n]?Object.assign(e[n],t[n]):e[n]=t[n];return e},i.elementApplyDefinition=function(e,t){for(var n in"string"==typeof t&&((t={})[arguments[1]]=arguments[2]),t){var o=t[n];if("function"==typeof o&&"on"!=n.substr(0,2)&&(o=o.call(e,e)),"tag"!=n&&"selector"!=n)if("children"!=n)if("class"!=n)if("style"!=n||"string"==typeof o)if("text"!=n)if("html"!=n)if("on"!=n.substr(0,2))if("api"!=n)n=n.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),e.setAttribute(n,o);else for(var a in null==e.api&&(e.api={}),o)"on"==a.substr(0,2)&&i.elementApplyDefinition(e,a,o[a]),e.api[a]=o[a].bind(e);else"append"==(n=n.substr(2))&&r.push(e),e.addEventListener(n,o,{options:{capture:!0}});else e.innerHTML=o;else e.nodeType==Node.TEXT_NODE?e.nodeValue=o:e.innerText=o;else for(var a in o)e.style[a]=o[a];else Array.isArray(o)&&(o=o.join(" ")),e.className&&(e.className+=" "),e.className+=o;else{Array.isArray(o)||(o=[o]);for(var l,s=i.createElement(o),f=0;l=s[f];f++)l instanceof Node&&e.appendChild(l)}}return e},i.inElement=function(e,t){if(e==t)return!0;for(var n=0;n<e.children.length;n++)if(i.inElement(e.children[n],t))return!0;return!1};for(var o,a=0;o=e[a];a++)o.prototype.set=function(e,t){var n=this;return"string"==typeof this&&(n=new String(this)),n.domfactorydefinition&&null!=n.domfactorydefinition.children?n.domfactorydefinition.children=n.domfactorydefinition.children.set(e,t):(null==e&&(e={}),n.domfactorydefinition||(n.domfactorydefinition={}),"object"!=typeof e&&((e={})[arguments[0]]=t),DomFactory.definitionAssign(n.domfactorydefinition,e)),n},o.prototype.append&&(o.prototype.originalAppend=o.prototype.append),o.prototype.append=function(e){return this.originalAppend&&e instanceof Node?this.originalAppend(e):(Array.isArray(e)||(e=Array.prototype.slice.call(arguments)),this.set("children",e))},o.prototype.on=function(e,t){var n=arguments[0];"string"==typeof n&&((n={})[e]=t);var r=this;for(var e in n)r=r.set("on"+e,n[e]);return r},o.prototype.createElement=function(e,t){return null!=e&&this.set.apply(this,arguments),i.createElement(this)},o.prototype.getLayout=function(e){if(this.domfactoryinstance)return this.domfactoryinstance.getLayout.apply(this.domfactoryinstance,arguments);console.error("[DomFactory] This element does not come from a layout")};return i.parseSelector=function(e){return e=e.replace(/ยง([\w-]+)/g,function(e,t){return'[layout="'+t.replace(/[A-Z]/g,e=>"."+e.toLowerCase())+'"]'})},["querySelector","querySelectorAll","closest","matches"].forEach(e=>{var t=HTMLElement.prototype[e];HTMLElement.prototype[e]=function(e){return t.call(this,i.parseSelector(e))}}),i}();